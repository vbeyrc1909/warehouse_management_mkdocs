<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>UR5_1 - VB#1909 Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "UR5_1";
    var mkdocs_page_input_path = "ur5_1.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> VB#1909 Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ubuntu/">Ubuntu 18.04</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ros/">ROS Melodic and Move It!</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../python/">Python 2.7</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../google/">Google App Scripting</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../hive/">Hive MQ</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../implementation/">Implementation</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">UR5_1</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#def-initself">def init(self):</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#def-on_transitionself-goal_handle">def on_transition(self, goal_handle):</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#def-send_goalself-arg_protocol-arg_mode-arg_topic-arg_message">def send_goal(self, arg_protocol, arg_mode, arg_topic, arg_message)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#class-ur5moveit">Class Ur5Moveit():</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#def-moveit_play_planned_path_from_fileself-arg_file_path-arg_file_name">def moveit_play_planned_path_from_file(self, arg_file_path, arg_file_name):</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#def-moveit_hard_play_planned_path_from_fileself-arg_file_path-arg_file_name-arg_max_attempts0">def moveit_hard_play_planned_path_from_file(self, arg_file_path, arg_file_name, arg_max_attempts=0):</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#def-attach_boxself-timeout4">def attach_box(self, timeout=4):</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#rospyinit_nodenode_move_ur5_1-anonymoustrue">rospy.init_node('node_move_ur5_1', anonymous=True)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#def-receive_orderorder">def receive_order(order):</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ur5_2/">UR5_2</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ros_iot/">ROS IOT Bridge</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../iot/">IOT</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">VB#1909 Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>UR5_1</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="ur5_1-python-script">UR5_1 Python Script</h1>
<p>We start by sending orders to the action server <br/></p>
<p>We define an action client class for IoT Ros Bridge <br/>
Class IotRosBridgeActionClient : <br/></p>
<h2 id="def-initself">def <strong>init</strong>(self):</h2>
<ul>
<li>actionlib.Actionclient initializes the Action Client by using a custom message file called msgRosIotAction which is used by ROS actions internally with the name ‘action_ros_iot.’</li>
<li>A dictionary is initialized to store all the orders/goal values</li>
<li>In order to publish on a topic to the client-side via MQTT broker, we store the MQTT Topic in a variable _config_mqtt_pub_topic according to the format specified in the config_pyiot yaml file </li>
<li>The next line waits for the action server to initiate/start so that we can send goals to the MQTT Topic</li>
</ul>
<h2 id="def-on_transitionself-goal_handle">def on_transition(self, goal_handle):</h2>
<ul>
<li>This function will be called when there is a change of state in the Action Client State Machine</li>
<li>It uses a parameter called goal_handle which is generated in another function called send_goal </li>
<li>Further, we check the goal’s communication state which monitors the State Machine of the Client which is different from Server's</li>
<li>If the communication state of the goal is 2 then the client is said to be active, if it is 3 then it’ll wait for the result &amp; when it is 7 then the work is done.</li>
<li>When the goal is done get the result produced from the action server. If result.flag_success is true then a message saying the Goal successfully completed is printed on the screen otherwise Goal will be failed.</li>
</ul>
<h2 id="def-send_goalself-arg_protocol-arg_mode-arg_topic-arg_message">def send_goal(self, arg_protocol, arg_mode, arg_topic, arg_message)</h2>
<ul>
<li>This function is used to send goals to the Action Server</li>
<li>Initially, we create a Goal message object using msgRosIotGoal which is a custom message class to store goal message. We initialize the variables according to action definition.</li>
</ul>
<h2 id="class-ur5moveit">Class Ur5Moveit():</h2>
<p>The constructor function of Ur5moveit defines all the properties of Ur5_1 arm. It defines a service variable to call activate_vacuum_gripper for ur5_1. </p>
<h2 id="def-moveit_play_planned_path_from_fileself-arg_file_path-arg_file_name">def moveit_play_planned_path_from_file(self, arg_file_path, arg_file_name):</h2>
<p>This function lets the ur5_1 use the saved path trajectory and allows the ur5_1 arm to play these trajectories stored as YAML files.</p>
<h2 id="def-moveit_hard_play_planned_path_from_fileself-arg_file_path-arg_file_name-arg_max_attempts0">def moveit_hard_play_planned_path_from_file(self, arg_file_path, arg_file_name, arg_max_attempts=0):</h2>
<p>This function works similar to move_it_play_path_from_file but causes the ur5 arms to run a number of times. It calls move_it_play_path_from_file a number of times till the flag_success variable returns False.</p>
<h2 id="def-attach_boxself-timeout4">def attach_box(self, timeout=4):</h2>
<p>Attach box functions activates the activate_vacuum_gripper service and grips the box to the ur5_1 arm. Detach_box function is called to deactivate the vacuum gripper &amp; detach the box from the ur5_1 and release it on the Conveyer Belt. </p>
<h2 id="rospyinit_nodenode_move_ur5_1-anonymoustrue">rospy.init_node('node_move_ur5_1', anonymous=True)</h2>
<p>We initialize objects for the classes defined in the script. Pack_details denotes the name od the red, yellow and green packages respectively. rospy.Publisher declares that the ros node is publishing to the topic - eyrc/vb/dispatched using message type string</p>
<h2 id="def-receive_orderorder">def receive_order(order):</h2>
<p>This function receives the incoming orders and reads the order details from order.message. It then sends the goal to the iot_ros_client to publish it on the google sheet named Incoming Orders. Ur5 then calls the function to go to the shelf to pick the desired package according to its priority, attaches the box, places the box on the conveyer belt and then detached the box from the vacuum-gripper.  As soon as ur5_1 places the box on the conveyer belt it sends the goal message to iot_ros_client to publish it on the google sheet named OrdersDispatched. Further, it stores the colours of the boxes according to the name of the item in an array pack_details. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ur5_2/" class="btn btn-neutral float-right" title="UR5_2">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../implementation/" class="btn btn-neutral" title="Implementation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../implementation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ur5_2/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
